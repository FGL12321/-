[TOC]



# Linux系统启动过程---目录结构---文件系统超详

# 1.0 Linux系统启动过程

linux启动时我们会看到许多启动信息

Linux系统的启动过程并不是大家想象中的那么复杂，**其过程可以分为5个阶段**：

- 内核的引导。
- 运行 init。
- 系统初始化。
- 建立终端 。
- 用户登录系统。

## 1.1内核引导

​		当计算机打开电源后，首先是BIOS开机自检，按照**BIOS中设置的启动设备（通常是硬盘）**来启动。

​		操作系统接管硬件以后，首先**读入 /boot 目录下的内核文件**。

![image-20220910022732566](https://pic-1313413291.cos.ap-nanjing.myqcloud.com/image-20220910022732566.png)

## 1.2运行init

​		**init 进程是系统所有进程的起点**，你可以把它比拟成系统所有进程的老祖宗，没有这个进程，系统中任何进程都不会启动。

​		init 程序首先是需要**读取配置文件 /etc/inittab**

![image-20220910022757734](https://pic-1313413291.cos.ap-nanjing.myqcloud.com/image-20220910022757734.png)

## 1.3运行级别

​		许多程序需要开机启动。它们在**Windows叫做"服务"（service），在Linux就叫做"守护进程"（daemon）**。

init进程的一大任务，就是去运行这些开机启动的程序。

​		但是，**不同的场合需要启动不同的程序**，比如用作服务器时，需要启动Apache，用作桌面就不需要。

​		Linux允许为不同的场合，分配不同的开机启动程序，这就叫做"运行级别"（runlevel）。也就是说，启动时根据"运行级别"，确定要运行哪些程序。

![image-20220910022827536](https://pic-1313413291.cos.ap-nanjing.myqcloud.com/image-20220910022827536.png)

Linux系统有7个运行级别(runlevel)：

- 运行级别0：系统停机状态，系统默认运行级别不能设为0，否则不能正常启动
- 运行级别1：单用户工作状态，root权限，用于系统维护，禁止远程登录
- 运行级别2：多用户状态(没有NFS)
- 运行级别3：完全的多用户状态(有NFS)，登录后进入控制台命令行模式
- 运行级别4：系统未使用，保留
- 运行级别5：X11控制台，登录后进入图形GUI模式
- 运行级别6：系统正常关闭并重启，默认运行级别不能设为6，否则不能正常启动

## 1.4系统初始化

​		在init的配置文件中有这么一行： si::sysinit:/etc/rc.d/rc.sysinit　它调用执行了**/etc/rc.d/rc.sysinit**，而rc.sysinit是一个bash shell的脚本，它主要是完成一些系统初始化的工作，rc.sysinit是每一个运行级别都要首先运行的重要脚本。

​		它主要完成的工作有：**激活交换分区，检查磁盘，加载硬件模块以及其它一些需要优先执行任务**。

![image-20220910022955410](https://pic-1313413291.cos.ap-nanjing.myqcloud.com/image-20220910022955410.png)

## 1.6建立终端

rc执行完毕后，返回init。这时**基本系统环境已经设置好了，各种守护进程也已经启动了。**

init接下来会**打开6个终端**，以便用户登录系统。在inittab中的以下6行就是定义了6个终端：

## 1.7用户登录系统

一般来说，用户的**登录方式有三种**：

- （1）命令行登录
- （2）ssh登录
- （3）图形界面登录

![image-20220910023049297](https://pic-1313413291.cos.ap-nanjing.myqcloud.com/image-20220910023049297.png)

## 1.8图形模式与文字模式的切换方式（补充）

​		Linux预设提供了六个命令窗口终端机让我们来登录。

​		默认我们登录的就是第一个窗口，也就是tty1，这个六个窗口分别为tty1,tty2 … tty6，你可以按下Ctrl + Alt + F1 ~ F6 来切换它们。

​		如果你安装了图形界面，默认情况下是进入图形界面的，此时你就可以按Ctrl + Alt + F1 ~ F6来进入其中一个命令窗口界面。

​		当你进入命令窗口界面后再返回图形界面只要按下Ctrl + Alt + F7 就回来了。

​		如果你用的vmware 虚拟机，命令窗口切换的快捷键为 Alt + Space + F1~F6. 如果你在图形界面下请按Alt + Shift + Ctrl + F1~F6 切换至命令窗口。

![image-20220910023136636](https://pic-1313413291.cos.ap-nanjing.myqcloud.com/image-20220910023136636.png)

## 1.9Linux 关机（补充）

​		在linux领域内大多用在服务器上，很少遇到关机的操作。毕竟服务器上跑一个服务是永无止境的，除非特殊情况下，不得已才会关机。

​		正确的关机流程为：sync > shutdown > reboot > halt

​		关机指令为：shutdown ，你可以man shutdown 来看一下帮助文档。

​		例如你可以运行如下命令关机：

```
sync 将数据由内存同步到硬盘中。

shutdown 关机指令，你可以man shutdown 来看一下帮助文档。例如你可以运行如下命令关机：

shutdown –h 10 ‘This server will shutdown after 10 mins’ 这个命令告诉大家，计算机将在10分钟后关机，并且会显示在登陆用户的当前屏幕中。

shutdown –h now 立马关机

shutdown –h 20:25 系统会在今天20:25关机

shutdown –h +10 十分钟后关机

shutdown –r now 系统立马重启

shutdown –r +10 系统十分钟后重启

reboot 就是重启，等同于 shutdown –r now

halt 关闭系统，等同于shutdown –h now 和 poweroff
```

最后总结一下，不管是重启系统还是关闭系统，首先要运行 **sync** 命令，把内存中的数据写到磁盘中。

关机的命令有 **shutdown –h now halt poweroff** 和 **init 0** , 重启系统的命令有 **shutdown –r now reboot init 6**。

# 2.0 Linux系统的目录结构

登录系统后，在当前命令窗口下输入命令：

```
 ls / 
```

![image-20220910023617567](https://pic-1313413291.cos.ap-nanjing.myqcloud.com/image-20220910023617567.png)

![image-20220910023627620](https://pic-1313413291.cos.ap-nanjing.myqcloud.com/image-20220910023627620.png)

**系统启动必须：**

- **/boot：**存放的启动Linux 时使用的内核文件，包括连接文件以及镜像文件。

- **/etc：**存放**所有**的系统需要的**配置文件**和**子目录列表，**更改目录下的文件可能会导致系统不能启动。

- **/lib**：存放基本代码库（比如c++库），其作用类似于Windows里的DLL文件。几乎所有的应用程序都需要用到这些共享库。

- **/sys**： 这是linux2.6内核的一个很大的变化。该目录下安装了2.6内核中新出现的一个文件系统 sysfs 。sysfs文件系统集成了下面3种文件系统的信息：针对进程信息的proc文件系统、针对设备的devfs文件系统以及针对伪终端的devpts文件系统。该文件系统是内核设备树的一个直观反映。当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中

**指令集合：**

- **/bin：**存放着最常用的程序和指令

- **/sbin：**只有系统管理员能使用的程序和指令。

**外部文件管理：**

- **/dev ：**Device(设备)的缩写, 存放的是Linux的外部设备。**注意：**在Linux中访问设备和访问文件的方式是相同的。

- **/media**：类windows的**其他设备，**例如U盘、光驱等等，识别后linux会把设备放到这个目录下。

- **/mnt**：临时挂载别的文件系统的，我们可以将光驱挂载在/mnt/上，然后进入该目录就可以查看光驱里的内容了。

**临时文件：**

- **/run**：是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。如果你的系统上有 /var/run 目录，应该让它指向 run。

- **/lost+found**：一般情况下为空的，系统非法关机后，这里就存放一些文件。

- **/tmp**：这个目录是用来存放一些临时文件的。

**账户：**

- **/root**：系统管理员的用户主目录。

- **/home**：用户的主目录，以用户的账号命名的。

- **/usr**：用户的很多应用程序和文件都放在这个目录下，类似于windows下的program files目录。

- **/usr/bin：**系统用户使用的应用程序与指令。

- **/usr/sbin：**超级用户使用的比较高级的管理程序和系统守护程序。

- **/usr/src：**内核源代码默认的放置目录。

**运行过程中要用：**

- **/var**：存放经常修改的数据，比如程序运行的日志文件（/var/log 目录下）。

- **/proc**：管理**内存空间！**虚拟的目录，是系统内存的映射，我们可以直接访问这个目录来，获取系统信息。这个目录的内容不在硬盘上而是在内存里，我们也可以直接修改里面的某些文件来做修改。

**扩展用的：**

- **/opt**：默认是空的，我们安装额外软件可以放在这个里面。

- **/srv**：存放服务启动后需要提取的数据**（不用服务器就是空）**

# 3.0Linux文件系统

​		在LINUX系统中有一个重要的概念：一切都是文件。 其实这是UNIX哲学的一个体现，而Linux是重写UNIX而来，所以这个概念也就传承了下来。在UNIX系统中，把一切资源都看作是文件，包括硬件设备。UNIX系统把每个硬件都看成是一个文件，通常称为设备文件，这样用户就可以用读写文件的方式实现对硬件的访问。

## 3.1Linux文件访问

​		我们应用程序访问硬盘，不会直接写代码来访问，而是通过OS的提供接口， OS的接口通常是文件系统的接口，对Linux操作系统而言，访问硬盘从软件到硬件，**从上到下大致可以分为三层：**

一、虚拟文件系统：通用抽象接口、具体文件系统、系统文件缓存。

二、设备驱动层：通用驱动接口、具体驱动接口

三、设备层(具体的硬件设备,可以理解为磁盘)
![image-20220910024741259](https://pic-1313413291.cos.ap-nanjing.myqcloud.com/image-20220910024741259.png)

​		目前在**Linux操作系统中支持很多种文件系统**，包括Ext2、Ext4、Btrfs和XFS等，多达几十个文件系统。虽然支持的文件系统种类很多，但从用户层面使用方式无任何差别，用户并不感知其中的差异，这个得益于虚拟文件系统提供通用抽象接口。

  	  **虚拟文件系统（VirtualFileSystem,VFS）**:隐藏了各种硬件的具体细节，把文件系统操作和不同文件系统的具体实现细节分离了开来，为所有的设备提供了统一的接口，VFS提供了多达数十种不同的文件系统。

​        虚拟文件系统可以分为逻辑文件系统和设备驱动程序。逻辑文件系统指Linux所支持的文件系统，如ext2,fat等，设备驱动程序指为每一种硬件控制器所编写的设备驱动程序模块。

## 3.2常见文件系统类型

​		Linux 系统能够支持的文件系统非常多，除 Linux 默认文件系统 Ext2、Ext3 和 Ext4 之外，还能支持 fat16、fat32、NTFS（需要重新编译内核）等 Windows 文件系统。也就是说，**Linux 可以通过挂载的方式使用 Windows 文件系统中的数据**。Linux 所能够支持的文件系统在 "/usr/src/kemels/当前系统版本/fs" 目录中（需要在安装时选择），该目录中的每个子目录都是一个可以识别的文件系统。我们介绍较为常见的 Linux 支持的文件系统，如表 1 所示。

![image-20220910024438268](https://pic-1313413291.cos.ap-nanjing.myqcloud.com/image-20220910024438268.png)